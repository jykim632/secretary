{"id":"secretary-1go","title":"테스트 코드 작성","description":"pytest, pytest-asyncio가 dev dependency에 있지만 테스트가 하나도 없음. services/, agent/tools/ 레이어에 대한 단위 테스트 필요.\n\n- memo_service CRUD 테스트\n- calendar_service CRUD 테스트\n- user_service get_or_create_user 테스트 (첫 사용자 admin, 이후 member)\n- MCP 도구 호출 테스트 (closure 바인딩 검증)\n- reminder_engine 동작 테스트","status":"closed","priority":1,"issue_type":"task","owner":"jykim632@gmail.com","created_at":"2026-02-18T08:30:47.426825+09:00","created_by":"jykim","updated_at":"2026-02-18T09:19:10.781337+09:00","closed_at":"2026-02-18T09:19:10.781337+09:00","close_reason":"서비스 레이어 단위 테스트 33개 작성 완료. user/memo/calendar service 전체 CRUD + visibility + ownership 검증.","comments":[{"id":2,"issue_id":"secretary-1go","author":"jykim","text":"## 변경 내용\n\n### 새로 생성된 파일\n- `tests/__init__.py`\n- `tests/conftest.py` — 인메모리 SQLite fixture (`db_session`, `sample_family`)\n- `tests/test_user_service.py` — 7개 테스트\n- `tests/test_memo_service.py` — 14개 테스트 (메모 7 + 할일 7)\n- `tests/test_calendar_service.py` — 12개 테스트 (일정 7 + 리마인더 5)\n\n### 수정된 파일\n- `pyproject.toml` — pytest 설정 추가 (`asyncio_mode = \"auto\"`, `testpaths`)\n\n### 테스트 커버리지\n- **user_service**: 첫 사용자 admin, 두번째 member, 중복 생성 방지, 플랫폼 조회, 가족 멤버 조회, 플랫폼 연동\n- **memo_service**: 메모/할일 CRUD, family/private visibility, 검색(제목/내용/태그), 소유권 검증 (수정/삭제 거부)\n- **calendar_service**: 일정 CRUD, 날짜 범위 필터링, 오늘 일정, family visibility, 리마인더 생성/조회/전송완료/취소, 소유권 검증\n\n총 33개 테스트, 전부 통과 (0.28초)\n","created_at":"2026-02-18T00:19:06Z"}]}
{"id":"secretary-2oe","title":"가족 그룹 초대/관리 기능 구현","status":"closed","priority":1,"issue_type":"feature","owner":"jykim632@gmail.com","created_at":"2026-02-18T10:16:33.265464+09:00","created_by":"jykim","updated_at":"2026-02-18T10:16:40.018234+09:00","closed_at":"2026-02-18T10:16:40.018234+09:00","close_reason":"초대 코드 기반 가족 그룹 관리 기능 구현 완료. FamilyInvite 모델, 초대 서비스 함수 6개, MCP 도구 4개, Telegram /start 초대코드 지원 및 /invite 명령 추가, 테스트 16개 통과"}
{"id":"secretary-3f0","title":"summarize_url HTML 파싱 개선","description":"search_tools.py의 summarize_url이 raw HTML을 그대로 3000자 잘라서 반환. HTML 태그가 섞여있어 Claude가 내용 파악하기 어려움.\n\n필요 작업:\n- beautifulsoup4 또는 간단한 정규식으로 HTML 태그 제거\n- \u003cscript\u003e, \u003cstyle\u003e 태그 내용 제거\n- 본문 텍스트만 추출하여 반환","status":"closed","priority":3,"issue_type":"task","owner":"jykim632@gmail.com","created_at":"2026-02-18T08:31:09.800417+09:00","created_by":"jykim","updated_at":"2026-02-18T10:00:34.782391+09:00","closed_at":"2026-02-18T10:00:34.782391+09:00","close_reason":"Closed"}
{"id":"secretary-3ut","title":"반복 리마인더 실제 구현","description":"is_recurring, recurrence_rule 필드가 DB에 있지만 reminder_engine의 mark_delivered()에서 반복 처리 로직이 없음. 현재는 단순히 is_delivered=True로만 설정.\n\n필요 작업:\n- mark_delivered() 후 is_recurring이면 다음 remind_at 계산하여 새 리마인더 생성 (또는 기존 리마인더의 remind_at 갱신 + is_delivered 리셋)\n- recurrence_rule: daily/weekly/monthly 각각 처리\n- 반복 종료 조건 (횟수 또는 종료일) 추가 고려","status":"closed","priority":2,"issue_type":"task","owner":"jykim632@gmail.com","created_at":"2026-02-18T08:30:49.295544+09:00","created_by":"jykim","updated_at":"2026-02-18T09:37:53.03604+09:00","closed_at":"2026-02-18T09:37:53.03604+09:00","close_reason":"Closed"}
{"id":"secretary-7uc","title":"가족 그룹 초대/관리 기능","description":"현재 모든 신규 사용자가 첫 번째 가족 그룹에 자동 join됨. 여러 가족을 구분하거나 초대를 관리하는 메커니즘이 없음.\n\n필요 작업:\n- 가족 초대 코드 생성/검증 시스템\n- 또는 admin이 초대 링크를 생성하여 공유\n- 새 사용자가 등록 시 초대 코드 입력으로 가족 그룹 지정\n- 별도 가족 그룹 생성 지원","status":"open","priority":3,"issue_type":"task","owner":"jykim632@gmail.com","created_at":"2026-02-18T08:31:16.476262+09:00","created_by":"jykim","updated_at":"2026-02-18T08:31:16.476262+09:00"}
{"id":"secretary-9jd","title":"텔레그램 긴 메시지 분할 전송","description":"텔레그램 메시지 길이 제한(4096자)에 대한 처리가 없음. Claude 응답이 길면 메시지가 잘리거나 에러 발생 가능.\n\n필요 작업:\n- telegram_bot.py의 send_message() 및 reply_text()에서 4096자 초과 시 분할 전송\n- 마크다운/코드블록 중간에서 끊기지 않도록 처리","status":"closed","priority":2,"issue_type":"task","owner":"jykim632@gmail.com","created_at":"2026-02-18T08:31:03.910085+09:00","created_by":"jykim","updated_at":"2026-02-18T09:37:53.058648+09:00","closed_at":"2026-02-18T09:37:53.058648+09:00","close_reason":"Closed"}
{"id":"secretary-b0b","title":"대화 이력 세션 복원","description":"ConversationHistory에 메시지를 저장하지만, AgentBrain 세션 재생성 시 이전 대화를 로드하지 않음. 서버 재시작이나 세션 만료 후 맥락이 완전히 소실됨.\n\n필요 작업:\n- _get_or_create_session()에서 최근 N개 대화 이력을 로드하여 세션에 주입\n- 또는 Claude Agent SDK의 conversation history 복원 메커니즘 활용\n- 대화 이력 TTL 설정 (예: 24시간 이내만 로드)","status":"closed","priority":2,"issue_type":"task","owner":"jykim632@gmail.com","created_at":"2026-02-18T08:30:57.968305+09:00","created_by":"jykim","updated_at":"2026-02-18T09:37:53.048178+09:00","closed_at":"2026-02-18T09:37:53.048178+09:00","close_reason":"Closed"}
{"id":"secretary-mzz","title":"시스템 프롬프트 시간 고정 문제 수정","description":"build_system_prompt()에서 datetime.now()를 호출하는데, AgentBrain이 세션을 캐시하므로 시스템 프롬프트의 '현재 시각'이 세션 생성 시점으로 고정됨.\n\n해결 방안:\n- process_message() 호출 시마다 시스템 프롬프트를 갱신하거나\n- get_current_datetime 도구에 의존하도록 시스템 프롬프트에서 시각 제거\n- 또는 일정 시간 경과 시 세션 자동 갱신","status":"closed","priority":1,"issue_type":"task","owner":"jykim632@gmail.com","created_at":"2026-02-18T08:30:51.141698+09:00","created_by":"jykim","updated_at":"2026-02-18T09:13:58.119102+09:00","closed_at":"2026-02-18T09:13:58.119102+09:00","close_reason":"시스템 프롬프트에서 datetime.now() 제거. 현재 시각은 get_current_datetime 도구 호출로 대체하여 세션 캐시와 무관하게 항상 정확한 시각 반환.","comments":[{"id":1,"issue_id":"secretary-mzz","author":"jykim","text":"## 변경 내용\n\n**system_prompt.py**\n- datetime import 및 datetime.now() 호출 제거\n- '현재 시각: {now}' → '시간대: {timezone}' + get_current_datetime 도구 호출 안내\n- 날짜 해석 규칙(4번)에도 get_current_datetime 먼저 확인하라는 지침 추가\n\n**brain.py**\n- 미사용 import 정리 (typing.Any, ToolUseBlock)\n\n**접근 방식**: 세션이 캐시되므로 시스템 프롬프트에 정적 시간을 넣으면 고정됨. 이미 존재하는 get_current_datetime 도구에 위임하여 매번 실시간 시각 반환.\n","created_at":"2026-02-18T00:15:22Z"}]}
{"id":"secretary-nbq","title":"대화 이력 정리 메커니즘","description":"conversation_history 테이블이 무한 성장. 오래된 대화 이력 정리 메커니즘이 없음.\n\n필요 작업:\n- 주기적으로 오래된 이력 삭제 (예: 30일 이전)\n- APScheduler에 일일 정리 작업 추가\n- 또는 사용자별 최대 이력 수 제한","status":"closed","priority":3,"issue_type":"task","owner":"jykim632@gmail.com","created_at":"2026-02-18T08:31:12.691789+09:00","created_by":"jykim","updated_at":"2026-02-18T10:00:34.793155+09:00","closed_at":"2026-02-18T10:00:34.793155+09:00","close_reason":"Closed"}
{"id":"secretary-s65","title":"에러 발생 시 세션 자동 복구","description":"brain.py의 process_message()에서 예외 발생 시 한국어 에러 메시지만 반환하고 세션 상태가 불완전할 수 있음. 연속 에러 시 세션이 꼬일 가능성.\n\n필요 작업:\n- process_message() 예외 시 해당 사용자 세션 자동 리셋\n- 또는 N회 연속 에러 시 세션 재생성\n- 에러 카운트 추적","status":"closed","priority":2,"issue_type":"task","owner":"jykim632@gmail.com","created_at":"2026-02-18T08:31:19.540678+09:00","created_by":"jykim","updated_at":"2026-02-18T09:37:53.070002+09:00","closed_at":"2026-02-18T09:37:53.070002+09:00","close_reason":"Closed"}
{"id":"secretary-unn","title":"슬랙 봇 사용자 이름 표시 개선","description":"slack_bot.py:75에서 display_name=slack_user_id로 설정. Slack user ID 문자열이 그대로 이름으로 저장됨.\n\n필요 작업:\n- Slack API (users.info)를 호출하여 실제 display_name 가져오기\n- self._app.client.users_info(user=slack_user_id)로 조회 가능","status":"closed","priority":3,"issue_type":"task","owner":"jykim632@gmail.com","created_at":"2026-02-18T08:31:00.782101+09:00","created_by":"jykim","updated_at":"2026-02-18T10:00:34.771302+09:00","closed_at":"2026-02-18T10:00:34.771302+09:00","close_reason":"Closed"}
{"id":"secretary-wf3","title":"웹 모니터링 대시보드 구현","status":"closed","priority":1,"issue_type":"feature","owner":"jykim632@gmail.com","created_at":"2026-02-18T16:33:27.314085+09:00","created_by":"jykim","updated_at":"2026-02-18T16:36:54.162916+09:00","closed_at":"2026-02-18T16:36:54.162916+09:00","close_reason":"웹 모니터링 대시보드 구현 완료"}
